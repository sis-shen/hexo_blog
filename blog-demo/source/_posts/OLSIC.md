---
title: ç½‘ç»œè‚¡ç¥¨ä¿¡æ¯çˆ¬è™«ä¸å¯è§†åŒ–
dat e: 2024-09-15 16:32:03
tags:
cover: https://picbed0521.oss-cn-shanghai.aliyuncs.com/blogpic/OLSIC_cover.png
---
# èƒŒæ™¯åˆ†æ

## èƒŒæ™¯æ¦‚è¿°
åœ¨å½“ä»Šå¿«é€Ÿå‘å±•çš„é‡‘èå¸‚åœºä¸­ï¼Œè‚¡ç¥¨å¸‚åœºçš„åŠ¨æ€å˜åŒ–å¯¹æŠ•èµ„è€…å’Œé‡‘èåˆ†æå¸ˆè‡³å…³é‡è¦ã€‚éšç€ä¿¡æ¯æŠ€æœ¯çš„è¿›æ­¥ï¼Œç‰¹åˆ«æ˜¯äº’è”ç½‘å’Œå¤§æ•°æ®æŠ€æœ¯çš„å‘å±•ï¼ŒæŠ•èµ„è€…å¯ä»¥å®æ—¶è·å¾—å¤§é‡çš„è‚¡ç¥¨å¸‚åœºä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿™äº›ä¿¡æ¯é€šå¸¸ä»¥åŸå§‹æ•°æ®å½¢å¼å­˜åœ¨ï¼Œéœ€è¦è¿›ä¸€æ­¥å¤„ç†å’Œåˆ†ææ‰èƒ½æå–æœ‰ä»·å€¼çš„æ´è§ã€‚åœ¨è¿™ç§èƒŒæ™¯ä¸‹ï¼Œç½‘ç»œè‚¡ç¥¨ä¿¡æ¯çˆ¬è™«ä¸å¯è§†åŒ–æŠ€æœ¯åº”è¿è€Œç”Ÿï¼Œæˆä¸ºè‚¡ç¥¨å¸‚åœºåˆ†æçš„é‡è¦å·¥å…·ã€‚

## ç½‘ç»œè‚¡ç¥¨ä¿¡æ¯çˆ¬è™«
ç½‘ç»œè‚¡ç¥¨ä¿¡æ¯çˆ¬è™«ï¼ˆWeb Scrapingï¼‰æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–çš„æ•°æ®æ”¶é›†æŠ€æœ¯ï¼Œæ—¨åœ¨ä»äº’è”ç½‘ä¸Šæå–è‚¡ç¥¨å¸‚åœºç›¸å…³çš„ä¿¡æ¯ã€‚å®ƒåˆ©ç”¨ç¨‹åºåŒ–æ–¹æ³•è®¿é—®å’ŒæŠ“å–å„ç§é‡‘èç½‘ç«™å’Œæ–°é—»å¹³å°ä¸Šçš„æ•°æ®ï¼Œä¾‹å¦‚è‚¡ç¥¨ä»·æ ¼ã€äº¤æ˜“é‡ã€å…¬å¸è´¢æŠ¥ã€æ–°é—»åŠ¨æ€ç­‰ã€‚çˆ¬è™«æŠ€æœ¯å¯ä»¥é«˜æ•ˆåœ°ä»å¤§è§„æ¨¡æ•°æ®æºä¸­è·å–æœ€æ–°çš„ä¿¡æ¯ï¼Œæ”¯æŒå®æ—¶æ•°æ®æ›´æ–°å’Œå†å²æ•°æ®å›æº¯åˆ†æã€‚

**å…³é”®æŠ€æœ¯**:
+ çˆ¬è™«æ¡†æ¶ï¼šå¦‚`Scrapy`ã€`BeautifulSoup`ç­‰ï¼Œç”¨äºè§£æHTMLé¡µé¢å’Œæå–æ•°æ®ã€‚
  + *ç”±äºæœ¬æ–‡çš„ç›®æ ‡ç½‘ç«™çš„è‚¡ç¥¨æ•°æ®å¹¶ä¸åœ¨é¡µé¢ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸éœ€è¦åšç½‘é¡µåˆ†æå’Œæå–*
+ APIæ¥å£ï¼šä¸€äº›é‡‘èç½‘ç«™æä¾›APIæ¥å£ï¼Œå…è®¸ç¨‹åºç›´æ¥è·å–ç»“æ„åŒ–çš„æ•°æ®ã€‚
  + (ä¾‹å¦‚æœ¬æ–‡ä½¿ç”¨`Get`æ–¹æ³•çš„httpsè¯·æ±‚ï¼Œè·å–äº†`json`æ–‡ä»¶)
+ æ•°æ®å­˜å‚¨ï¼šæŠ“å–çš„æ•°æ®é€šå¸¸éœ€è¦å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¦‚`MySQL`ã€`MongoDB`ç­‰ï¼Œä»¥ä¾¿åç»­åˆ†æå’Œå¤„ç†ã€‚
  + (æœ¬æ–‡ä½¿ç”¨ä½œè€…ä¸ªäººæœåŠ¡å™¨ä¸ŠMYSQLä½œä¸ºå­˜å‚¨æ•°æ®åº“)

## æ•°æ®å¯è§†åŒ–
æ•°æ®å¯è§†åŒ–æ˜¯å°†å¤æ‚çš„è‚¡ç¥¨å¸‚åœºæ•°æ®ä»¥å›¾å½¢åŒ–çš„æ–¹å¼å‘ˆç°å‡ºæ¥ï¼Œä½¿å¾—æ•°æ®æ›´æ˜“äºç†è§£å’Œåˆ†æã€‚é€šè¿‡å¯è§†åŒ–æŠ€æœ¯ï¼ŒæŠ•èµ„è€…å¯ä»¥ç›´è§‚åœ°è§‚å¯Ÿè‚¡ç¥¨ä»·æ ¼è¶‹åŠ¿ã€äº¤æ˜“é‡å˜åŒ–ã€å¸‚åœºæ³¢åŠ¨ç­‰é‡è¦ä¿¡æ¯ï¼Œä»è€Œåšå‡ºæ›´åŠ æ˜æ™ºçš„æŠ•èµ„å†³ç­–ã€‚

**å¸¸ç”¨å¯è§†åŒ–æ–¹æ³•**:
+ æ—¶é—´åºåˆ—å›¾ï¼šç¤ºè‚¡ç¥¨ä»·æ ¼æˆ–äº¤æ˜“é‡éšæ—¶é—´å˜åŒ–çš„è¶‹åŠ¿ã€‚
+ èœ¡çƒ›å›¾ï¼ˆCandlestickChartï¼‰:ç”¨äºè‚¡ç¥¨ä»·æ ¼åœ¨ä¸€å®šæ—¶é—´å†…çš„å¼€ç›˜ã€æ”¶ç›˜ã€æœ€é«˜å’Œæœ€ä½ä»·æ ¼ã€‚
  + åˆç§°`Kå›¾`ï¼Œæ–‡æœ¬å°±æ˜¯ä½¿ç”¨Kå›¾ä½œä¸ºå¯è§†åŒ–æ–¹å¼
+ çƒ­åŠ›å›¾ï¼ˆHeatmapï¼‰:ç”¨é¢œè‰²å¼ºåº¦è¡¨ç¤ºä¸åŒè‚¡ç¥¨çš„è¡¨ç°æˆ–å¸‚åœºçš„çƒ­ç‚¹åŒºåŸŸã€‚
+ æ•£ç‚¹å›¾å’ŒæŠ˜çº¿å›¾ï¼šç”¨äºå±•ç¤ºå¤šç»´æ•°æ®ä¹‹é—´çš„å…³ç³»å’Œè¶‹åŠ¿ã€‚

## å°ç»“
ç½‘ç»œè‚¡ç¥¨ä¿¡æ¯çˆ¬è™«ä¸å¯è§†åŒ–æŠ€æœ¯åœ¨é‡‘èå¸‚åœºåˆ†æä¸­å…·æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚å®ƒä»¬ä¸ä»…å¯ä»¥å¸®åŠ©æŠ•èµ„è€…å®æ—¶ç›‘æ§å¸‚åœºåŠ¨æ€ï¼Œè¿˜èƒ½å¤Ÿé€šè¿‡å†å²æ•°æ®åˆ†æé¢„æµ‹æœªæ¥è¶‹åŠ¿ã€‚æ­¤å¤–ï¼Œè¿™äº›æŠ€æœ¯è¿˜è¢«ç”¨äºé‡åŒ–åˆ†æã€ç®—æ³•äº¤æ˜“ã€é£é™©ç®¡ç†ç­‰é¢†åŸŸï¼Œä»¥æé«˜æŠ•èµ„å†³ç­–çš„ç§‘å­¦æ€§å’Œå‡†ç¡®æ€§ã€‚  

ç½‘ç»œè‚¡ç¥¨ä¿¡æ¯çˆ¬è™«ä¸å¯è§†åŒ–æŠ€æœ¯ä¸ºç°ä»£é‡‘èå¸‚åœºæä¾›äº†å¼ºå¤§çš„æ•°æ®æ”¯æŒå’Œåˆ†æå·¥å…·ã€‚é€šè¿‡è‡ªåŠ¨åŒ–æ•°æ®æŠ“å–å’Œå›¾å½¢åŒ–å‘ˆç°ï¼ŒæŠ•èµ„è€…å¯ä»¥æ›´é«˜æ•ˆåœ°è·å–å¸‚åœºä¿¡æ¯å’Œæ´å¯Ÿï¼Œæœ‰åŠ©äºåšå‡ºæ›´å‡†ç¡®çš„æŠ•èµ„å†³ç­–ã€‚éšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œè¿™äº›å·¥å…·å°†åœ¨é‡‘èåˆ†æä¸­å‘æŒ¥è¶Šæ¥è¶Šé‡è¦çš„ä½œç”¨ã€‚

## ä¸šåŠ¡æµç¨‹å›¾

![](https://picbed0521.oss-cn-shanghai.aliyuncs.com/blogpic/OLSIC_flowchart.png)

# ä»£ç å®ç°ä¸šåŠ¡åŠŸèƒ½

## ä»£ç æ¡†æ¶

+ ç½‘ç»œçˆ¬è™«
  + ä½¿ç”¨`requests`æ¨¡å—å‘ç½‘ç«™å‘é€å®šåˆ¶çš„`https`è¯·æ±‚
  + ä½¿ç”¨`json`å¤„ç†ç½‘ç«™è¿”å›çš„`json`æ•°æ®
  + çˆ¬è™«éƒ¨åˆ†çš„ä»£ç å°è£…åœ¨`SnowBallCrawler.pyä¸­`
+ æ•°æ®åº“æŒä¹…åŒ–
  + åœ¨`mysql`ä¸­åˆ›å»ºé¡¹ç›®æ‰€éœ€çš„æ•°æ®åº“å’Œè¡¨
  + ä½¿ç”¨`pymysql`æ¨¡å—è¿æ¥æ•°æ®åº“å¹¶æ‰§è¡Œæ’å…¥å’ŒæŸ¥è¯¢æ“ä½œ
+ GUIå¯è§†åŒ–
  + ä½¿ç”¨`dearpygui`æ¨¡å—å®ç°GUIå¯è§†åŒ–å¹¶ç®¡ç†ç»„ä»¶
  + ä½¿ç”¨`dearpygui`çš„ç»Ÿè®¡å›¾ç»˜åˆ¶åŠŸèƒ½ç»˜åˆ¶`Kå›¾`
  + é¡¹ç›®çš„ä¸»è¦é€»è¾‘é›†æˆåœ¨å¯è§†åŒ–ä»£ç çš„ä¸»è¦éƒ¨åˆ†
  + å°†è‡ªå®šä¹‰çš„å¤æ‚ç»„ä»¶å°è£…åœ¨ç±»é‡Œ

## ç½‘ç»œçˆ¬è™«
æˆ‘ä»¬é¦–å…ˆæ¥å®ç°ç½‘ç»œçˆ¬è™«éƒ¨åˆ†ï¼Œè¿™é‡Œçš„ç›®æ ‡ç½‘ç«™æ˜¯[é›ªçƒç½‘ç«™çš„èŒ…å°è‚¡ç¥¨](https://xueqiu.com/S/SH600519)

### ç½‘é¡µåˆ†æ

ä¸€èˆ¬è‚¡ç¥¨ç½‘ç«™çš„æ•°æ®ä¸ä¼šç›´æ¥æ”¾åœ¨åŸå§‹çš„`https`è¯·æ±‚çš„å“åº”ä¸­ï¼Œæ‰€ä»¥è¦æ‰“å¼€`F12`åˆ†æç½‘ç«™çš„äºŒæ¬¡è¯·æ±‚çš„å†…å®¹ï¼Œæ–¹æ³•æœ‰ä¸¤ç§:

**æ–¹æ³•ä¸€å¦‚å›¾**:

1. æŒ‰ä¸‹`f12`æ‰“å¼€ç½‘é¡µåˆ†æå™¨
2. ç‚¹å‡»é€‰é¡¹å¡ä¸­çš„`ç½‘ç»œ(Network)`åˆ‡æ¢åˆ°å¯¹åº”çš„é¡µé¢,å¹¶é€‰ä¸­ä¸‹æ–¹çš„`Fetch/XHR`åˆ†ç±»å¡
3. åˆ·æ–°ç½‘é¡µï¼Œå¹¶ç‚¹å‡»ç½‘ç«™ä¸­çš„`æ—¥K`é€‰é¡¹ï¼Œé¼ æ ‡æ‚¬åœåœ¨æŸä¸€å¤©çš„çº¿ä¸Š
4. ä»æ‚¬åœæç¤ºçš„æ•°å­—ä¸­é€‰ä¸€ä¸ªæ¯”è¾ƒæœ‰å”¯ä¸€æ€§çš„ï¼ˆæ¯”å¦‚æ”¶ç›˜ä»·ï¼‰,åœ¨æœç´¢ä¸­å¡«å…¥é€‰ä¸­çš„æ•°å­—
5. ä¸€èˆ¬è¿™æ ·å°±èƒ½é€‰å‡ºå”¯ä¸€çš„å“åº”äº†ï¼Œé‡Œé¢å°±å­˜ç€æˆ‘ä»¬æ‰€éœ€è¦çš„æ•°æ®ï¼ˆæˆ‘ä»¬è¿™ä¸ªä¾‹å­å°±æœ‰280å¤šæ¡æ•°æ®ï¼‰

![](https://picbed0521.oss-cn-shanghai.aliyuncs.com/blogpic/OLSIC_page1.png)

**æ–¹æ³•äºŒ**

å¦‚æœæ–¹æ³•ä¸€æœç´¢ä¸å‡ºæ¥ï¼Œè¿˜å¯ä»¥ä½¿ç”¨é™å®šæŠ“åŒ…æ—¶é—´çš„æ–¹æ³•ï¼Œå‡å°æœç´¢èŒƒå›´

1. æŒ‰ä¸‹`f12`æ‰“å¼€ç½‘é¡µåˆ†æå™¨
2. ç‚¹å‡»é€‰é¡¹å¡ä¸­çš„`ç½‘ç»œ(Network)`åˆ‡æ¢åˆ°å¯¹åº”çš„é¡µé¢,å¹¶é€‰ä¸­ä¸‹æ–¹çš„`Fetch/XHR`åˆ†ç±»å¡
3. åˆ·æ–°ç½‘é¡µï¼Œç­‰å¾…ç½‘é¡µå®Œå…¨åŠ è½½åï¼Œå†æ¥å›åˆ‡æ¢`æ—¥K`å’Œ`å‘¨Kï¼ˆæˆ–å…¶å®ƒç±»ä¼¼é€‰é¡¹å¡ï¼‰`,è§‚å¯Ÿæ—¶é—´è½´çª—å£çš„å˜åŒ–
4. æœ€åç‚¹å‡»`æ—¥K`é€‰é¡¹å¡ï¼Œåœ¨æ—¶é—´è½´çª—å£å•å‡»å‘ç”Ÿå˜åŒ–çš„åœ°æ–¹ï¼Œç„¶åè°ƒæ•´è§‚å¯ŸåŒºé—´
5. æœç´¢ç­›é€‰å‡ºæ¥çš„å“åº”

![](https://picbed0521.oss-cn-shanghai.aliyuncs.com/blogpic/202410091905283.gif)

***

å¦‚å›¾ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†æƒ³è¦çš„å“åº”ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ†ææ ‡å¤´`header`,æ¥ä¸‹æ¥ç‚¹å‡»æ ‡å¤´é€‰é¡¹å¡

+ è¯·æ±‚`URL`

![](https://picbed0521.oss-cn-shanghai.aliyuncs.com/blogpic/OLSIC_header.png)

å¦‚å›¾ï¼Œç›®æ ‡ç½‘ç«™ä½¿ç”¨äº†`GET`æ–¹æ³•è¯·æ±‚æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç€é‡åˆ†æ`GET`æ–¹æ³•çš„`å‚æ•°`å’Œ`æ— å‚URL`(ç”¨äºæ‹¼æ¥è¯·æ±‚URL)ï¼Œè€Œå‚æ•°å°±åœ¨`URL`ä¸­

æ‹†åˆ†å‚æ•°å¹¶è½¬æ¢æˆpythonå­—å…¸åå¦‚ä¸‹
```Python
param_data = {
            'symbol':'SH600519',
            'begin':1726713214191,
            'period':'day',
            'type':'before',
            'count':'-284',
            'indicator':'kline,pe,pb,ps,pcf,market_capital,agt,ggt,balance'
        }
```
å¾ˆæ˜æ˜¾ï¼Œ`begin`æ˜¯æ—¶é—´æˆ³ï¼Œç”¨äºè¯·æ±‚æœ€æ–°çš„æ•°æ®,ä½†æ˜¯æ¯”è¾ƒç‰¹åˆ«çš„ï¼Œç½‘ç«™ç”¨çš„æ˜¯`æ•´æ•°çš„æ¯«ç§’çº§æ—¶é—´æˆ³`,åœ¨pythonä¸­ä½¿ç”¨timeæ¨¡å—ä¼ å½“å‰çš„`begin`å€¼æ—¶å¾—æ³¨æ„

å› ä¸ºæœ¬é¡¹ç›®åªçˆ¬å–ä¸€æ”¯è‚¡ç¥¨çš„ä¿¡æ¯ï¼Œå‰©ä¸‹çš„å‚æ•°ä¸ä½œè§£æ

+ æ ‡å¤´(`header`)

ä¸ºäº†é˜²æ­¢è¢«ç½‘ç«™çš„åçˆ¬å–ç»™æ‹¦æˆªä¸‹æ¥ï¼Œæ ‡å¤´éœ€è¦å’Œè‡ªå·±åœ¨ç½‘ç«™é‡ŒæŸ¥åˆ°çš„ä¿æŒä¸€è‡´

è½¬æˆpythonå­—å…¸çš„ä»£ç å¦‚ä¸‹

```Python
self.headers = {
            'Accept':'application/json, text/plain, */*',
            'Accept-Encoding':'gzip, deflate, br, zstd',
            'Accept-Language':'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6',
            'Cookie':'è¯·ä½¿ç”¨è‡ªå·±çš„Cookie,æœ¬æ–‡ä½œè€…å·²éšå»',
            'Origin':'https://xueqiu.com',
            'Priority':'u=1, i',
            'Referer':'https://xueqiu.com/S/SH600519',
            'Sec-Ch-Ua':'"Not/A)Brand";v="8", "Chromium";v="126", "Microsoft Edge";v="126"',
            'sec-ch-ua-mobile':'?0',
            'sec-ch-ua-platform':'"Windows"',
            'Sec-Fetch-Dest':'empty',
            'Sec-Fetch-Mode':'cors',
            'Sec-Fetch-Site':'same-site',
            'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36 Edg/126.0.0.0'
        }
```

### å°è£…ç±»
å› ä¸ºåªçˆ¬å–ä¸€æ”¯è‚¡ç¥¨ï¼Œå°±ä¸å°è£…é€šç”¨æ€§å¼ºçš„ç±»äº†ï¼Œè€Œæ˜¯åªé’ˆå¯¹è¿™ä¸€æ”¯è‚¡ç¥¨ï¼Œæ‰€ä»¥å°è£…ä¸€ä¸ª`GZMaoTai`ç±»,å¹¶æä¾›`get_response`æ¥å£ï¼Œå‘å¤–ç•Œä¼ é€æ¯æ¬¡çˆ¬å–çš„æ•°æ®ã€‚å…¶ä¸­å¯¹è¿”å›çš„josonæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨`Josn`æ¨¡å—å°†å…¶ååºåˆ—åŒ–ï¼Œå¹¶å‚¨å­˜åœ¨Pythonåˆ—è¡¨ä¸­è¿”å›

```Python
import requests
import json
import time

class GZMaoTai:
    def __init__(self):

        self.url = 'https://stock.xueqiu.com/v5/stock/chart/kline.json'
        self.headers = {
            'Accept':'application/json, text/plain, */*',
            'Accept-Encoding':'gzip, deflate, br, zstd',
            'Accept-Language':'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6',
            'Cookie':'è¯·ä½¿ç”¨è‡ªå·±çš„Cookie,æœ¬æ–‡ä½œè€…å·²éšå»',
            'Origin':'https://xueqiu.com',
            'Priority':'u=1, i',
            'Referer':'https://xueqiu.com/S/SH600519',
            'Sec-Ch-Ua':'"Not/A)Brand";v="8", "Chromium";v="126", "Microsoft Edge";v="126"',
            'sec-ch-ua-mobile':'?0',
            'sec-ch-ua-platform':'"Windows"',
            'Sec-Fetch-Dest':'empty',
            'Sec-Fetch-Mode':'cors',
            'Sec-Fetch-Site':'same-site',
            'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36 Edg/126.0.0.0'
        }


    def get_response(self,date):
        nowtime = int(time.time() * 1000.0)
        param_data = {
            'symbol':'SH600519',
            'begin':str(nowtime),
            'period':'day',
            'type':'before',
            'count':'-284',
            'indicator':'kline,pe,pb,ps,pcf,market_capital,agt,ggt,balance'
        }
        print("å¼€å§‹çˆ¬å–æ•°æ®")
        response = requests.get(self.url,headers=self.headers,params=param_data,timeout=5)
        print(response.text)
        print("çˆ¬å–æˆåŠŸï¼Œæ•°æ®åŒ…å¦‚ä¸Š")

        data_json = json.loads(response.text)  # Jsonååºåˆ—åŒ–
        items = data_json['data']['item']
        # for i in range(len(items)):
        # print(items[i])
        # jsonæ•°æ®å¯¹åº”
        # [0] timestamp
        # [1] æˆäº¤é‡
        # [2] å¼€ç›˜ä»·
        # [3] æœ€é«˜ä»·
        # [4] æœ€ä½ä»·
        # [5] æ”¶ç›˜ä»·
        # [6] æ¶¨è·Œé¢
        # [7] æ¶¨è·Œå¹…
        # [8] æ¢æ‰‹ç‡
        # [9] æˆäº¤é¢(äº¿)
        # [10] null
        # [11] null
        # [12]
        return items
```
## æ•°æ®åº“æŒä¹…åŒ–

### æ•°æ®åº“å‡†å¤‡

è¿™é‡Œä½¿ç”¨è¿œç«¯çš„`MYSQL`ç®¡ç†æ•°æ®åº“,ä½œè€…ä½¿ç”¨äº†è‡ªå·±çš„æœåŠ¡å™¨,å…·ä½“çš„é…ç½®å’Œå®‰è£…ä¸ä½œä»‹ç»ã€‚

1. æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç”¨äºå­˜å‚¨è‚¡ç¥¨è¡¨çš„æ•°æ®åº“`stock`

```mysql
create database if not exists stock
```

2. æˆ‘ä»¬é’ˆå¯¹æœ¬æ¬¡å®éªŒï¼Œå†åˆ›å»ºä¸€ä¸ª`MaoTai`è¡¨ã€‚ï¼ˆè‹¥è¦è‡ªåŠ¨å»ºè¡¨ï¼Œåˆ™è¿™éƒ¨åˆ†åœ¨ä»£ç å®ç°ï¼‰
```mysql
create table MaoTai(
    timesamp bigint not null,
    volume int not null,
    open decimal(8,4) not null,
    high decimal(8,4) not null,
    low decimal(8,4) not null,
    close decimal(8,4) not null,
    chg decimal(8,4) not null,
    percent decimal(8,4) not null,
    turnoverrate decimal(8,4) not null,
    amount decimal(12,1) not null
);
```
ç‰¹åˆ«è¯´æ˜åœ°ï¼Œè¿™è¾¹çš„`timesamp`æ˜¯æ‹¼å†™é”™è¯¯ğŸ˜…,è¿™ä¸ªè¡¨ç»“æ„ä¸æ˜¯ç‰¹åˆ«å¥½çœ‹ï¼Œä¹Ÿæ²¡æœ‰è®¾ç½®ä¸»é”®ï¼Œ~~~äº²èº«å®è·µï¼Œæ—¶é—´æˆ³å¤ªå¤§äº†ï¼Œä¸èƒ½ä½œä¸ºä¸»é”®ï¼Œå¦åˆ™è¿™ä¸ªè¡¨çš„å¢åˆ æŸ¥æ”¹ä¼šè¶…æ—¶~~~

3. æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸“é—¨ç®¡ç†è‚¡ç¥¨æ•°æ®åº“çš„è¿œç¨‹ç™»å½•è´¦æˆ·`supdiver`,å¹¶æŠŠç”¨æˆ·æƒé™é™å®šåœ¨`stock.MaoTai`è¡¨ä¸Š

Mysql8.0è¯­æ³•
```mysql
create user supdriver@% identified by 'å¯†ç 'ï¼›

grant all privileges on stock.MaoTai to supdriver@%
```

### ä»£ç å°è£…
å¯¹äºæ•°æ®åº“çš„æ“ä½œä¸»è¦æ˜¯å°è£…å‡ ä¸ªæ¥å£ï¼Œæ‰€ä»¥å°±ç›´æ¥æŠŠæœ‰å…³çš„å‡½æ•°å£°æ˜åœ¨`DBManager.py`æ¨¡å—ä¸­ï¼Œè€Œä¸å°è£…æˆç±»äº†ã€‚

ä¸»è¦æ“ä½œå°±æ˜¯è¿æ¥åˆ°æ•°æ®åº“ï¼Œç„¶ååˆ›å»º`cursor`æŒ‡é’ˆç”¨äºæ‰§è¡Œ`mysql`è¯­å¥å¹¶è·å–è¿”å›å€¼

*æ³¨:hostä¸ºmysqlæ‰€åœ¨æœåŠ¡å™¨çš„å…¬æœ‰ip,æœ¬æ–‡å°†ä½œè€…è‡ªå·±æœåŠ¡å™¨çš„å®é™…ipæ”¹æˆäº†æœ¬åœ°è·¯ç”±ç¯å›çš„127.0.0.1*
```Python
import pymysql

stockDB = pymysql.Connect(
    host='47.99.48.121',
    port=3306,
    user='supdriver',
    password='',
    db='stock',
    charset='utf8',
    autocommit=True
)


def sendData(items):
    stockDB.ping(reconnect=True)
    cursor = stockDB.cursor()
    print("å¼€å§‹å‘æ•°æ®åº“æ’å…¥æ•°æ®")
    for item in items:
        sql=(f"insert into MaoTai values ({item[0]},"
             f"{item[1]},"
             f"{item[2]},"
             f"{item[3]},"
             f"{item[4]},"
             f"{item[5]},"
             f"{item[6]},"
             f"{item[7]},"
             f"{item[8]},"
             f"{item[9]});")
        # print(sql)
        cursor.execute(sql)
        # print(cursor.fetchall())
    print(f"æ’å…¥æ•°æ®æˆåŠŸï¼Œæ€»è®¡{len(items)}")

def getAllData(stockDB):
    stockDB.ping(reconnect=True)
    cursor = stockDB.cursor()
    sql= "select * from MaoTai"
    cursor.execute(sql)
    return cursor.fetchall()

def getLatestData():
    stockDB.ping(reconnect=True)

    cursor=stockDB.cursor()
    sql="select * from MaoTai order by timesamp desc"
    cursor.execute(sql)
    alldata = cursor.fetchall()
    resList = []
    for line in alldata:
        resList.append(line)

    return resList
def closeDB():
    stockDB.close()

def clearDB():
    stockDB.ping(reconnect=True)

    cursor = stockDB.cursor()
    sql='delete from MaoTai'
    print("å¼€å§‹æ¸…ç†æ•°æ®åº“")
    cursor.execute(sql)
    print('æ¸…ç†å®Œæˆ')
```

## GUIå¯è§†åŒ–å’ŒKå›¾ç»˜åˆ¶
æ¥ä¸‹æ¥å°±æ˜¯æ•´ä¸ªé¡¹ç›®çš„é‡å¤´æˆï¼Œç»è¿‡å‰é¢çš„å°è£…ï¼Œæ•°æ®çš„è·å–ï¼Œå‚¨å­˜å’Œé¢„å¤„ç†å·²ç»å®Œæˆ

æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„å¯è§†åŒ–æ¨¡å—å«åš[dearpygui](https://dearpygui.readthedocs.io/en/latest/index.html#),*åé¢ç®€ç§°`dpg`*

å…³äºå¯è§†åŒ–ç»„ä»¶çš„ä¸Šä¸‹æ–‡ï¼Œå°†äº¤ç”±`dearpygui`è‡ªåŠ¨ä¸ºç»´æŠ¤,è¿™é‡Œå¯¹`dpg`ä¸å¤šä½œä»‹ç»ï¼Œå…ˆä»‹ç»æœ€é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼š`dpg`ä¸­æ‰€æœ‰çš„ç»„ä»¶éƒ½æœ‰è‡ªå·±çš„`uuid`ç”¨äºç»´æŠ¤ï¼Œå› æ­¤å¯¹ç»„ä»¶çš„ç®¡ç†å°±æ˜¯å¯¹ç»„ä»¶`id`çš„ç®¡ç†ï¼Œå…¶ä¸­`id`æ—¢å¯ä»¥æ˜¯æ•´å‹ä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²

### é¡µé¢è®¾è®¡
åšå·¥ç¨‹è¦æœ‰è“å›¾ï¼Œåšå¯è§†åŒ–å½“ç„¶è¦æœ‰é¡µé¢è®¾è®¡æ¥æŒ‡å¯¼ä»£ç å®ç°ï¼Œå¦åˆ™æƒ³åˆ°å“ªåšåˆ°å“ªä¼šååˆ†ç¼ºä¹æ•ˆç‡ã€‚æˆ‘ä»¬é¢„æœŸçš„é¡µé¢è®¾è®¡å¦‚ä¸‹

![](https://picbed0521.oss-cn-shanghai.aliyuncs.com/blogpic/OLSIC_mainDesign01108329.png)

### å°è£…ä¸»çª—å£ç±»å¹¶æ˜¾ç¤º
æ‰€æœ‰çš„dpgçš„å¯è§†åŒ–ç»„ä»¶éœ€è¦åˆ›å»ºåœ¨dpgçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæ‰€ä»¥è¦å°è£…ç±»ï¼Œå°±å¾—ä½¿ç”¨å…¶æä¾›çš„`dpg.stage()`æ¥åœ¨ç±»é‡Œåˆ›å»ºä¸´æ—¶ä¸Šä¸‹æ–‡

> DVWrapper.py
```Python
import time

import dearpygui.dearpygui as dpg
from SnowBallCrawler import  *

class Window:

    def __init__(self,label,tag):
        with dpg.stage() as stage: # åˆ›å»ºä¸´æ—¶ä¸Šä¸‹æ–‡
            self.id = dpg.add_window(label=label,tag=tag) # åœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ªwindowç»„ä»¶
        self.stage = stage # å‚¨å­˜ä¸´æ—¶ä¸Šä¸‹æ–‡çš„id

    def add_child(self,child): # ç›´æ¥æ·»åŠ å«æœ‰self.idçš„è‡ªå®šä¹‰ç±»ä¸ºå­©å­
        dpg.move_item(child.id,parent=self.id)

    def add_childID(self,childID): # æŒ‰ç…§idæ·»åŠ å­©å­
        dpg.move_item(childID,parent=self.id)

    def submit(self): # å°†ä¸´æ—¶ä¸Šä¸‹æ–‡åˆå¹¶åˆ°ä¸»dpgä¸Šä¸‹æ–‡,æ•ˆæœä¸Šæ˜¯è®©ç»„ä»¶å¯è§
        dpg.unstage(self.stage)

```

åœ¨`DVWrapper.py`ä¸­å°è£…å¥½`Window`ç±»åï¼Œæˆ‘ä»¬åœ¨`DataVisual.py`ä¸­åˆ›å»º`dpg`çš„ä¸Šä¸‹æ–‡å¹¶å°†`Window`ç±»å®ä¾‹åŒ–å‡ºæ¥

> DataVisual.py

```Python
from DVWrapper import *
import DBManager as dbm
import time

dpg.create_context() # åˆ›å»ºdpgä¸Šä¸‹æ–‡

main_win = Window(label="main_win",tag="main_win") # å®ä¾‹åŒ–

main_win.submit() # æäº¤ç»„ä»¶

# ä»¥ä¸‹çš„ä»£ç ä¸ºå›ºå®šä»£ç æ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼Œä¸å¤šä½œè®²è§£
dpg.create_viewport(title='Custom Title', width=1400, height=600)
dpg.setup_dearpygui()
dpg.show_viewport()
dpg.set_primary_window("main_win", True) # çœŸæ­£è®¾ç½®åˆå§‹çª—å£(å¯é€‰)
dpg.start_dearpygui()

dpg.destroy_context()

```

### å°è£…å­çª—å£ç±»
å…‰æœ‰ä¸»çª—å£è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦å­çª—å£æ¥é™åˆ¶æœªæ¥è¦å±•ç¤ºçš„è¡¨æ ¼ï¼Œé˜²æ­¢è¡¨æ ¼è¿‡é•¿ï¼Œå ç”¨ä¸»çª—å£è¿‡å¤šçš„ç©ºé—´
> DVWrapper.py

```python
class Child_Window:
    def __init__(self,width=1200,height=300,tag=TOP_CHILD_WINDOW):
        with dpg.stage():
            self.id = dpg.add_child_window(tag=tag,width=width,height=height)
    def add_child(self,child): # æä¾›å¢åŠ å­ç»„ä»¶çš„æ¥å£
        dpg.move_item(child.id,parent=self.id)
```


### å°è£…Tableç±»
æˆ‘ä»¬å°è£…ä¸€ä¸ª`Table`ç±»æ¥æ‰§è¡Œæ›´æ–°è¡¨æ ¼å’Œæ˜¾ç¤ºè¡¨æ ¼çš„åŠŸèƒ½

> DVWrapper.py

```python
def mystampToNumStr(stamp): # å°è£…ä¸€ä¸ªæŠŠæ¯«ç§’çº§æ—¶é—´æˆ³è½¬æ¢æˆå¹´æœˆæ—¥çš„å‡½æ•°
    date = time.strftime("%Y/%m/%d", time.localtime(int(stamp / 1000.0)))
    return date

TOP_CHILD_WINDOW = "top_child_win" # å®šä¹‰é»˜è®¤çš„å­çª—å£id

# å‡†å¤‡ä¸€ä¸ªå‚¨å­˜åˆ—åç§°çš„åˆ—è¡¨ï¼Œæ–¹ä¾¿å»ºç«‹è¡¨æ ¼
columns = ['åºå·','æ—¶é—´','æˆäº¤é‡(æ‰‹)','å¼€ç›˜ä»·','æœ€é«˜ä»·','æœ€ä½ä»·','æ”¶ç›˜ä»·','æ¶¨è·Œé¢','æ¶¨è·Œå¹…','æ¢æ‰‹ç‡','æˆäº¤é¢(äº¿)']

class DataTable:
    def __init__(self,tag='main table'):
        with dpg.stage(): # åˆ›å»ºä¸´æ—¶ä¸Šä¸‹æ–‡
            self.id = dpg.add_table(header_row=True, policy=dpg.mvTable_SizingFixedFit, row_background=True, reorderable=True,
                   resizable=True, no_host_extendX=False, hideable=True,
                   borders_innerV=True, delay_search=True, borders_outerV=True, borders_innerH=True,
                   borders_outerH=True,tag=tag)  # åˆ›å»ºä¸€ä¸ªä¼šè‡ªåŠ¨ä¼¸ç¼©ï¼Œå¯ä¿®æ”¹åˆ—å®½åº¦çš„ï¼Œæ¯”è¾ƒè‡ªç”±çš„è¡¨æ ¼

            dpg.push_container_stack(self.id) # å±•å¼€è¡¨æ ¼ç»„ä»¶çš„ä¸Šä¸‹æ–‡ï¼Œä¸‹é¢åˆ›å»ºçš„ç»„ä»¶è‡ªåŠ¨æˆä¸ºè¡¨æ ¼çš„å­ç»„ä»¶
            # æ·»åŠ è¡¨æ ¼çš„åˆ—
            for i in range(len(columns)):
                dpg.add_table_column(label=columns[i],width_stretch=True, init_width_or_weight=0.0)

            dpg.pop_container_stack() # å…³é—­è¡¨æ ¼çš„ä¸Šä¸‹æ–‡


    def clearData(self):
        # æ¸…é™¤åˆ—è¡¨
        for item in dpg.get_item_children(self.id,1):
            dpg.delete_item(item)
    def updateData(self,items): # ä¸Šä¼ æ•°æ®åˆ°è¡¨æ ¼

        dpg.push_container_stack(self.id) # æ‰“å¼€è¡¨æ ¼çš„ä¸Šä¸‹æ–‡
        row = 0
        for item in items:
            row+=1
            with dpg.table_row():
                dpg.add_text(str(row)) # è¾“å…¥è¡Œå·åˆ°è¡Œå·åˆ—
                for j in range(len(item)):
                    if(j == 0): # æ—¶é—´è¦è½¬æ¢æˆæ—¶é—´æˆ³
                        date = mystampToNumStr(item[0])
                        dpg.add_text(date)
                    elif(j==10):
                        break
                    else:
                        dpg.add_text(item[j])

        dpg.pop_container_stack()

```

### å°è£…KPlotç±»

KPlotå¯¹å¤–åªè´Ÿè´£`æ¥å—æ•°æ®`å’Œ`ç»˜åˆ¶ç»Ÿè®¡å›¾`ï¼Œè€Œå†…éƒ¨çš„å·¥ä½œæœ‰ï¼š

+ è§£ææ•°æ®
+ åˆ›å»ºå›¾æ ‡
+ ç»˜åˆ¶å›¾æ ‡
+ æä¾›é¼ æ ‡æ‚¬åœæç¤º

> DVWrapper.py

```python
class KPlot:
    def __init__(self):
        with dpg.stage():
            # åˆ›å»ºä¸€ä¸ªplotç»„ä»¶
            with dpg.plot(label="è´µå·èŒ…å°è‚¡ç¥¨æ—¥Kå›¾",tag='kplot',height=-1,width=-1,show=False) as self.id:
                dpg.add_plot_legend()

    def draw(self,fetch_data):
        xData=[]
        # è¿™é‡Œä½¿ç”¨åŸç”Ÿå­—å…¸+åˆ—è¡¨è§£æè·å–åˆ°çš„æ•°æ®
        yDatas={"volume":[],"open":[],"high":[],"low":[],
                "close":[],"chg":[],"percent":[],
                "turnoverrate":[],"amount":[]}
        for line in fetch_data:
            line = list(line) #å°†å…ƒç»„è½¬æˆåˆ—è¡¨ï¼Œè¿™æ ·æ‰èƒ½æ‰§è¡Œpopæ“ä½œ

            xData.append(line.pop(0)/1000)
            yDatas["volume"].append(line.pop(0))
            yDatas["open"].append(line.pop(0))
            yDatas["high"].append(line.pop(0))
            yDatas["low"].append(line.pop(0))
            yDatas['close'].append(line.pop(0))
            yDatas['chg'].append(line.pop(0))
            yDatas['percent'].append(line.pop(0))
            yDatas['turnoverrate'].append(line.pop(0))
            yDatas['amount'].append(line.pop(0))

        def custom_tooltip_handler(sender,app_data): #å£°æ˜ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç”¨äºåœ¨é¼ æ ‡ä¸Šæ‚¬åœæ˜¾ç¤ºæ¯å¤©çš„è‚¡ç¥¨å‚æ•°
            x_data,y_data=dpg.get_plot_mouse_pos()
            date = mystampToNumStr(x_data*1000)  # å°†æ¨ªåæ ‡æ—¶é—´æˆ³è½¬æ¢æˆå…·ä½“æ—¥æœŸ
            index = 0
            # é€šè¿‡æ—¥æœŸåå‘å¯»æ‰¾ä¸‹æ ‡ï¼Œç„¶åå†é€šè¿‡ä¸‹æ ‡æ‰¾åˆ°å½“å¤©è‚¡ç¥¨çš„æ•°æ®
            while( index < len(xData) and date != mystampToNumStr(xData[index]*1000) ):
                index+=1
            if(index < len(xData)):
                # é€šè¿‡setValueè®¾ç½®æ‚¬åœæ˜¾ç¤ºçš„ä¿¡æ¯
                dpg.set_value("volume tip",f"æ—¶é—´:{date} \n "
                                           f"æˆäº¤é‡:{yDatas['volume'][index]}\n"
                                           f"å¼€ç›˜ä»·:{yDatas['open'][index]}\n"
                                           f"æœ€é«˜ä»·:{yDatas['high'][index]}\n"
                                           f"æœ€ä½ä»·:{yDatas['low'][index]}\n"
                                           f"æ”¶ç›˜ä»·:{yDatas['close'][index]}\n"
                                           f"æ¶¨è·Œé¢:{yDatas['chg'][index]}\n"
                                           f"æ¶¨è·Œå¹…{yDatas['percent'][index]}\n"
                                           f"æ¢æ‰‹ç‡:{yDatas['turnoverrate'][index]}\n"
                                           f"æˆäº¤é¢:{yDatas['amount'][index]}")

        with dpg.handler_registry(tag="volume hander"):
            # å°†é¼ æ ‡ç§»åŠ¨äº‹ä»¶çš„å›è°ƒå‡½æ•°ç»‘å®šæˆä¸Šé¢çš„è‡ªå®šä¹‰å‡½æ•°
            dpg.add_mouse_move_handler(callback=custom_tooltip_handler)

        # å‡†å¤‡å¼€å§‹ç»˜åˆ¶æ›²çº¿
        dpg.push_container_stack(self.id)
        xaxis = dpg.add_plot_axis(dpg.mvXAxis,label="æ—¥æœŸ",time=True) # åˆ›å»ºæ¨ªåæ ‡,å¹¶æ ‡è®°ä¸ºä»¥æ—¶é—´ä¸ºæ¨ªåæ ‡
        dpg.add_plot_axis(dpg.mvYAxis,label='å¼€ç›˜ä»·',tag="open") # åˆ›å»ºçºµåæ ‡1
        dpg.add_plot_axis(dpg.mvYAxis,label='æ¢æ‰‹ç‡',tag="turnoverrate") # åˆ›å»ºçºµåæ ‡2
        dpg.add_plot_axis(dpg.mvYAxis,label='äº¤æ˜“é¢',tag="amount") # åˆ›å»ºçºµåæ ‡3


        dpg.add_line_series(xData,yDatas["volume"],parent="amount",label="æˆäº¤é‡") # ç»˜åˆ¶æŠ˜çº¿å›¾
        # ç»˜åˆ¶Kå›¾
        s1id = dpg.add_candle_series(xData,opens=yDatas['open'],closes=yDatas['close'],lows=yDatas['low'],highs=yDatas['high'],parent='open',label='Kå›¾',time_unit=dpg.mvTimeUnit_Day)
        dpg.add_line_series(xData,yDatas["open"],parent='open',label="å¼€ç›˜ä»·") # ç»˜åˆ¶æŠ˜çº¿å›¾ï¼Œä¸‹åŒ
        dpg.add_line_series(xData,yDatas["high"],parent='open',label="æœ€é«˜ä»·")
        dpg.add_line_series(xData,yDatas["low"],parent='open',label='æœ€ä½ä»·')
        dpg.add_line_series(xData,yDatas["close"],parent='open',label='æ”¶ç›˜ä»·')
        dpg.add_line_series(xData,yDatas["chg"],parent='turnoverrate',label='æ¶¨è·Œé¢')
        dpg.add_line_series(xData,yDatas["percent"],parent='turnoverrate',label='æ¶¨è·Œå¹…')
        dpg.add_line_series(xData,yDatas["turnoverrate"],parent='turnoverrate',label='æ¢æ‰‹ç‡')
        dpg.add_line_series(xData,yDatas["amount"],parent='amount',label='æˆäº¤é¢')

        dpg.fit_axis_data(xaxis) # ä½¿æ¨ªåæ ‡è‡ªé€‚åº”ï¼Œæœ€ç»ˆæ˜¾ç¤ºä¸ºå…·ä½“æ—¥æœŸ
        with dpg.tooltip(s1id,label='tool tip',tag="tool tip"): # åˆ›å»ºé¼ æ ‡æ‚¬åœæ˜¾ç¤ºçš„ç»„ä»¶
            dpg.add_text("Hover the plot",tag="volume tip")

        dpg.pop_container_stack()

```

### å°è£…MenuBarç±»
`dpg`çš„`menu_bar`ç»„ä»¶å°±åªæ˜¯å•çº¯çš„èœå•æ ï¼Œå†…éƒ¨æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥å¾—å…ˆå°è£…`MenuItem`ç±»

```python
class MenuItem():
    def __init__(self,menubar,label,tag,target): # èœå•é€‰é¡¹ä¸å¤šä¸ªç»„ä»¶æœ‰å…³
        self.parent = menubar.id # å‚¨å­˜parentçš„id
        self.target = target # å‚¨å­˜ç›®æ ‡ç©ºé—´çš„id
        dpg.push_container_stack(self.parent)  # å°†è‡ªå·±æ·»åŠ åˆ°parentä¸­
        self.id = dpg.add_menu_item(label=label,tag=tag,user_data=[menubar,self])
        dpg.pop_container_stack()

    def HideCallback(self):
        current_visible = dpg.is_item_visible(self.target)  # è·å–å½“å‰å¯è§æ€§
        if current_visible:
            dpg.hide_item(self.target) # è‹¥å¯è§ï¼Œåˆ™éšè—
    def setCallback(self,callback): # è®¾ç½®å½“èœå•é€‰é¡¹è¢«ç‚¹å‡»æ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°
        dpg.set_item_callback(self.id,callback=callback)
class MenuBar():
    def __init__(self,tag='main menu'):
        self.children = [] # åˆ—è¡¨ç”¨äºç®¡ç†æ‰€æœ‰å­ç»„ä»¶ï¼ˆæƒ¨æ·¡é€‰é¡¹ï¼‰
        with dpg.stage():
            self.id = dpg.add_menu_bar(tag=tag)

    def add_item(self,label,tag,target,font): # è®¾è®¡æ€æƒ³ä¸Šï¼Œèœå•é€‰é¡¹å¿…é¡»èƒ½è¿‡ç®¡ç†å®ƒå¯¹åº”çš„ç›®æ ‡ç»„ä»¶ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªtargetæˆå‘˜å˜é‡å‚¨å­˜ç›®æ ‡id
        self.children.append(MenuItem(self,label=label,tag=tag,target=target))
        child_id = self.children[-1].id
        dpg.bind_item_font(child_id,font) # ç»‘å®šèœå•é€‰é¡¹çš„å­—ä½“(ç”±å¤–éƒ¨æä¾›)
        self.children[-1].HideCallback() # æ–°çš„å­©å­é»˜è®¤è°ƒç”¨ä¸€ä¸‹ä½¿ç›®æ ‡éšè—çš„å›è°ƒå‡½æ•°
        return child_id # è¿”å›æ–°æ’å…¥å­©å­çš„id,å¤–è¾¹å¤–ç•Œç»‘å®šå›è°ƒå‡½æ•°

    def hide_children(self):# æä¾›ä½¿æ‰€æœ‰è¢«æ§ç»„ä»¶éšè—çš„æ¥å£(ä¸æ˜¯è®©èœå•é€‰é¡¹éšè—)
        for child in self.children:
            child.HideCallback() # è§„å®šMenuItemç±»å¿…é¡»æœ‰ä¸€ä¸ªHideCallbackå›è°ƒå‡½æ•°

```

### å°è£…æ°´å¹³æŒ‰é’®ç»„
è™½ç„¶ç›®å‰åªæœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ä»¥ååœ¨åŒä¸€è¡Œæ”¾æ›´å¤šçš„æŒ‰é’®ï¼Œæˆ‘ä»¬é€‰æ‹©å†é¢å¤–å°è£…ä¸€ä¸ª`Group`

```python
class HorGroup:
    def __init__(self,width=40):# æä¾›å¯è®¾ç½®çš„å®½åº¦
        with dpg.stage():
            # horizontal=True,è®¾ç½®ç»„å†…çš„ç»„ä»¶æ°´å¹³æ”¾ç½®
            self.id = dpg.add_group(horizontal=True,width=width)

    def add_child(self,child): #  æä¾›å¢åŠ å­ç»„ä»¶çš„æ¥å£
        dpg.move_item(child.id,parent=self.id)

    def add_spacer(self):#  æä¾›å¢åŠ ç©ºä½çš„æ¥å£
        dpg.push_container_stack(self.id)
        dpg.add_spacer()
        dpg.pop_container_stack()

class Button:
    def __init__(self,label,tag):
        with dpg.stage():
            self.id=dpg.add_button(label=label,tag=tag,width=150,height=40)

    def setcallback(self,callback):
        dpg.set_item_callback(self.id,callback=callback)

```

### ç±»å®ä¾‹åŒ–å’Œæ„å»ºå¯è§†åŒ–é¡µé¢
ç‰¹åˆ«çš„ï¼Œç”±äº`dpg`é»˜è®¤ä¸æ”¯æŒä¸­æ–‡å­—ä½“ï¼Œæ‰€ä»¥è¦åœ¨é¡¹ç›®é‡Œå‡†å¤‡ä¸€ä¸ªæ”¯æŒä¸­æ–‡è‡ªå·±çš„æ–‡ä»¶ï¼Œå¹¶åœ¨ç¨‹åºä¸­ä½¿ç”¨è¯¥å­—ä½“ï¼Œæ‰èƒ½æ­£å¸¸æ˜¾ç¤ºä¸­æ–‡

```python
import dearpygui.dearpygui as dpg

from DVWrapper import *
import DBManager as dbm
import time


maotai = GZMaoTai()
def getTimestamp():# è·å–ç§’çº§çš„å½“å‰æ—¶é—´æˆ³
    t=time.time()
    return int(round(t*1000))

dpg.create_context()

def commonMenuCallback(sender,app_data,user_data): # å£°æ˜é€šç”¨çš„èœå•é€‰é¡¹çš„å›è°ƒå‡½æ•°
    user_data[0].hide_children() #è§„å®šuser_data[0]ä¸ºèœå•å¯¹è±¡,éšè—æ‰€æœ‰è¢«æ§ç»„ä»¶
    dpg.show_item(user_data[1].target) # æœ€åå†åªæ˜¾ç¤ºè‡ªå·±

def DBUpdateCallback(sender,app_data):  # å£°æ˜æŒ‰ä¸‹æŒ‰é’®çš„å›è°ƒå‡½æ•°
    dpg.set_item_label(sender,"æ•°æ®æ›´æ–°ä¸­...") #æ›´æ”¹æŒ‰é’®æ˜¾ç¤ºå†…å®¹
    dpg.disable_item(sender) # è°ƒç”¨å‡½æ•°æœŸé—´ä½¿æŒ‰é’®æ— æ•ˆåŒ–
    dbm.clearDB() # æ¸…ç©ºæ•°æ®åº“
    my_table.clearData() # æƒ…å†µè¡¨æ ¼
    items = maotai.get_response(getTimestamp())  # è·å–æœ€æ–°æ•°æ®
    dbm.sendData(items)  # å‘æ•°æ®åº“å‘é€æ•°æ®
    fetch_data = dbm.getLatestData()  # ä»æ•°æ®åº“è·å–æ•°æ®
    my_table.updateData(fetch_data)  # æ›´æ–°è¡¨æ ¼
    dpg.set_item_label(sender,"æ›´æ–°æ•°æ®åº“æ•°æ®")  # æ”¹å›æŒ‰é’®çš„æ˜¾ç¤ºå†…å®¹
    dpg.enable_item((sender)) # é‡æ–°å¯ç”¨æŒ‰é’®


######  è®¾ç½®å­—ä½“ ###########

with dpg.font_registry():
    with dpg.font("./fonts/msyh.ttc",20) as default_font:
        dpg.add_font_range_hint(dpg.mvFontRangeHint_Chinese_Simplified_Common)
    with dpg.font("./fonts/msyh.ttc",25) as big_font:
        dpg.add_font_range_hint(dpg.mvFontRangeHint_Chinese_Simplified_Common)
    with dpg.font("./fonts/msyh.ttc",20) as menufont:
        dpg.add_font_range_hint(dpg.mvFontRangeHint_Chinese_Simplified_Common)



###### ç¨‹åºä¸»è¦å†…å®¹ ########
# æ„å»ºå¯è§†åŒ–ç»„ä»¶
my_table = DataTable() # å®ä¾‹åŒ–è¡¨æ ¼

update_button = Button(label="æ›´æ–°æ•°æ®åº“æ•°æ®",tag="update button") # å®ä¾‹åŒ–æŒ‰é’®
update_button.setcallback(DBUpdateCallback)  # è®¾ç½®å›è°ƒå‡½æ•°

kplot = KPlot() # å®ä¾‹åŒ–å›¾æ ‡

menubar = MenuBar() # å®ä¾‹åŒ–èœå•æ 

# æ·»åŠ èœå•æ é€‰é¡¹
table_menu = menubar.add_item(label="è¡¨æ ¼",tag="table",target=my_table.id,font=menufont)
kplot_menu = menubar.add_item(label="æ—¥Kå›¾",tag="Kplot",target=kplot.id,font=menufont)
# ç»‘å®šæƒ¨æ·¡äº†é€‰é¡¹çš„å›è°ƒå‡½æ•°
dpg.set_item_callback(table_menu,commonMenuCallback)
dpg.set_item_callback(kplot_menu,commonMenuCallback)
# åˆ›å»ºçª—å£
main_win = Window(label="main_win",tag="main_win")
# åˆ›å»ºå­çª—å£
top_child_win = Child_Window(width=-1,height=400)
top_child_win.add_child(my_table)
top_child_win.add_child(kplot)

## æ„å»ºçˆ¶å­å…³ç³»
dpg.bind_font(default_font)
dpg.bind_item_font(update_button.id,big_font)
dpg.bind_item_font(menubar.id,menufont)
main_win.add_child(menubar)
main_win.add_child(top_child_win)



button_group = HorGroup(width=300)
button_group.add_spacer()
inner_group = HorGroup()
inner_group.add_child(update_button)
# inner_group.add_child(clear_button)
button_group.add_child(inner_group)
button_group.add_spacer()
main_win.add_child(button_group)

main_win.submit()


# items = maotai.get_response(getTimestamp())

fetch_data = dbm.getLatestData()
my_table.updateData(fetch_data)
kplot.draw(fetch_data)


dbm.closeDB()
dpg.create_viewport(title='Custom Title', width=1400, height=600)
dpg.setup_dearpygui()
dpg.show_viewport()
dpg.set_primary_window("main_win", True) # çœŸæ­£è®¾ç½®åˆå§‹çª—å£
dpg.start_dearpygui()

dpg.destroy_context()
```
# æˆå“å±•ç¤º
*(æ–‡ä»¶è¾ƒå¤§ï¼Œè¯·è€å¿ƒç­‰å¾…åŠ è½½)*

![](https://picbed0521.oss-cn-shanghai.aliyuncs.com/blogpic/202410091543883.gif)
# å°ç»“
åœ¨æœ¬æ¬¡é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†äº’è”ç½‘çˆ¬è™«æŠ€æœ¯å’Œå¯è§†åŒ–æŠ€æœ¯å®Œæˆäº†é¡¹ç›®ç›®æ ‡ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°æŸ¥è¯¢è‚¡ç¥¨æ•°æ®å’Œåˆ†æè‚¡ç¥¨çš„æ—¥Kå›¾ã€‚

[æˆ³æˆ‘å»githubä»“åº“ğŸ”—](https://github.com/sis-shen/OLSIC)

