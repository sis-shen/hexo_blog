---
title: 设计模式的C++实现(2)——代理模式
date: 2024-09-24 19:24:16
tags: 设计模式
---
# 代理模式

> **模式名称**: 代理模式-Proxy
> **类型**: 结构型
> **问题-使用场景**: 在执行类和用户间再增加一个中间人，执行类的交互对于用户来说过于复杂，执行类的接口对参数检查较严格等
> **解决方案**： 可以封装一个类，为用户提供更简洁的接口，而与执行类的交互在其内部实现；或者封装一个头文件，在里面封装全局函数和宏函数等
> **效果**： 增加代码复杂性，封装层数更高，更加抽象。具体实现方式十分多样，增加了代码编写者的工作，但减少了用户的使用难度，也能一定程度上提高安全性

代理模式指代理控制对其他对象的访问， 也就是**代理对象控制对原对象的引⽤**。在某些情况下，⼀**个对象不适合或者不能直接被引⽤访问**，⽽代理对象可以在客⼾端和⽬标对象之间起到`中介的作⽤`。代理模式的结构包括⼀个是真正的你要访问的对象(⽬标类)、⼀个是代理对象。⽬标对象与代理对象实现同⼀个接⼝，先访问代理类再通过代理类访问⽬标对象

按照编译时和运行时的行为，代理模式分为`静态代理`、`动态代理`：
+ `静态代理`指的是，在**编译时就**已经**确定好**了代理类和被代理类的关系。也就是说，在编译时就已经确定了代理类要代理的是哪个被代理类。
+ `动态代理`指的是，在**运⾏时才动态⽣成**代理类，并将其与被代理类绑定。这意味着，在运⾏时才能确定代理类要代理的是哪个被代理类。

*以租房为例，房东将房⼦租出去，但是要租房⼦出去，需要发布招租启⽰， 带⼈看房，负责维修，这些⼯作中有些操作并⾮房东能完成，因此房东为了图省事，将房⼦委托给中介进⾏租赁。*

![](https://picbed0521.oss-cn-shanghai.aliyuncs.com/blogpic/202409260830884.png)

```C++
/*房东要把⼀个房⼦通过中介租出去理解代理模式*/
#include <iostream>
#include <string>
class RentHouse {
public:
	virtual void rentHouse() = 0;
};
/*房东类：将房⼦租出去*/
class Landlord : public RentHouse {
public:
	void rentHouse() {
		std::cout << "将房⼦租出去\n";
	}
};
/*中介代理类：对租房⼦进⾏功能加强，实现租房以外的其他功能*/
class Intermediary : public RentHouse {
public:
	void rentHouse() {
		std::cout << "发布招租启⽰\n";
		std::cout << "带⼈看房\n";
		_landlord.rentHouse();
		std::cout << "负责租后维修\n";
	}
private:
	Landlord _landlord;
};
int main()
{
	Intermediary intermediary;
	intermediary.rentHouse();
	return 0;
}
```

# 具体应用

+ [C++基于多设计模式下的同步&异步⽇志系统🔗](https://www.supdriver.top/2024/09/24/muiltiDesignPatternsLogSystem/)中对日志系统使用代理模式，用`suplog.hpp`作为代理人与用户交互